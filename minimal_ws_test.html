<!DOCTYPE html>
<html>
<head>
    <title>Minimal WebSocket Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>âš¡ Minimal WebSocket Test</h1>
    <button onclick="testWS()">Test WebSocket</button>
    <pre id="output">Ready to test...</pre>

    <script>
        function log(msg) {
            const output = document.getElementById('output');
            output.textContent += '\n' + new Date().toLocaleTimeString() + ': ' + msg;
        }
        
        function testWS() {
            log('ðŸš€ Starting WebSocket test...');
            
            // ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ URL Ð´Ð»Ñ WebSocket Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ ÑÑ€ÐµÐ´Ñ‹
            let wsUrl;
            const isCloudEnv = location.hostname.endsWith('.app.github.dev') || location.hostname.includes('gitpod.io');

            if (isCloudEnv) {
                const backendHost = location.hostname.replace(location.port, '8000');
                wsUrl = `wss://${backendHost}/ws`;
            } else {
                wsUrl = 'ws://localhost:8000/ws';
            }
            
            log(`ðŸ”— Connecting to: ${wsUrl}`);
            
            try {
                const ws = new WebSocket(wsUrl);
                log('âœ… WebSocket object created');
                
                ws.onopen = () => {
                    log('ðŸŽ‰ WebSocket CONNECTED!');
                    ws.send('Hello from minimal test!');
                    log('ðŸ“¤ Sent test message');
                };
                
                ws.onmessage = (e) => {
                    log('ðŸ“¨ Received: ' + e.data);
                };
                
                ws.onclose = (e) => {
                    log('âŒ WebSocket closed: ' + e.code + ' - ' + e.reason);
                };
                
                ws.onerror = (e) => {
                    log('ðŸ”¥ WebSocket ERROR!');
                    console.error('WebSocket error:', e);
                };
                
            } catch (error) {
                log('ðŸ’¥ Failed to create WebSocket: ' + error.message);
            }
        }
        
        // Auto-test
        setTimeout(testWS, 1000);
    </script>
</body>
</html>
