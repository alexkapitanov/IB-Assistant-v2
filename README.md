# InfoSec Assistant (multi-agent + RAG)

* FastAPI backend, React frontend.
* –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: Dialog-Manager ‚ûú Planner (gpt-4.1) ‚ûú ExpertGC (gpt-4.1).
* Redis ‚Äî —Å–ª–æ—Ç—ã, SQLite ‚Äî –ø–æ–ª–Ω—ã–π –ª–æ–≥, Qdrant ‚Äî RAG, MinIO ‚Äî —Ñ–∞–π–ª—ã.

## –û–±–ª–∞—Å—Ç—å –∑–Ω–∞–Ω–∏–π

**–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –æ–±—É—á–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ‚Äî  
DLP, SIEM, SOC, —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã, –Ω–æ—Ä–º–∞—Ç–∏–≤—ã –∏ —É—è–∑–≤–∏–º–æ—Å—Ç–∏.**  
–ï—Å–ª–∏ —Å–ø—Ä–æ—Å–∏—Ç—å –æ —á—ë–º-—Ç–æ –≤–Ω–µ —ç—Ç–æ–π –æ–±–ª–∞—Å—Ç–∏, –æ–Ω —á–µ—Å—Ç–Ω–æ —Å–∫–∞–∂–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç.

## –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### üîë –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```bash
OPENAI_API_KEY=sk-***        # –±–µ–∑ –Ω–µ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤–µ—Ä–Ω—ë—Ç –æ—à–∏–±–∫—É
```

### üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ:
- `REDIS_URL` - URL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: redis://localhost:6379)
- `QDRANT_URL` - URL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Qdrant (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: http://localhost:6333)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```bash
OPENAI_API_KEY=sk-your-actual-openai-key-here
```

**‚ö†Ô∏è –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:**

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`** –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å –≤–∞—à–∏–º OpenAI API –∫–ª—é—á–æ–º
2. **–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ API –∫–ª—é—á–∞** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `OPENAI_API_KEY=stub`
3. **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã: Redis, Qdrant, MinIO
4. **–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö WebSocket** –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs backend`

## Quick start
```bash
docker-compose up --build
```

### –ü–µ—Ä–≤–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

```bash
docker compose exec backend \
  python scripts/index_files.py --reindex
```

### –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è / –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

```bash
# –ó–∞–≥—Ä—É–∑–∏–ª–∏ PDF –≤—Ä—É—á–Ω—É—é –≤ MinIO –∫–æ–Ω—Å–æ–ª—å ‚Üí –∑–∞–ø—É—Å–∫–∞–µ–º reindex
docker compose exec backend python scripts/index_files.py --reindex

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
docker compose exec backend \
   python scripts/index_files.py --paths ib-docs/questionnaires/*.pdf

# –ö–∞—Å—Ç–æ–º–Ω—ã–π bucket –∏ prefix
docker compose exec backend \
   python scripts/index_files.py --paths /path/to/files/*.pdf custom-bucket custom-prefix/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ MinIO
docker compose exec backend python -c "
from minio import Minio
mc = Minio('minio:9000', access_key='minioadmin', secret_key='minioadmin', secure=False)
for obj in mc.list_objects('ib-docs', recursive=True):
    print(f'{obj.object_name} ({obj.size} bytes)')
"
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
flowchart TD
  U[User] --> WS[WebSocket /ws]
  WS --> API[FastAPI handle_message]
  API --> DM[Dialog Manager]
  DM -->|small-talk| SmallTalk[–ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è]
  DM -->|file shortcut| FileRetrieval[get_file_link]
  DM -->|request/kb_search| KBSearch[KB-Search-Agent]
  KBSearch -->|reuse| ReuseAnswer[–ì–æ—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –∏–∑ –ø–∞–º—è—Ç–∏]
  KBSearch -->|escalate + context| Planner[ask_planner]
  Planner -->|need_clarify| Clarify[–£—Ç–æ—á–Ω–µ–Ω–∏–µ]
  Planner -->|need_escalate + plan| Expert[run_expert_gc]
  Planner -->|draft| Draft[–ì–æ—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç]
  Expert -->|—Å –ø–ª–∞–Ω–æ–º ‚úì| ExpertAnswer[–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç]
  FileRetrieval --> Response[send_json]
  SmallTalk --> Response
  ReuseAnswer --> Response
  Clarify --> Response
  ExpertAnswer --> Response
  Draft --> Response
```

### –ü–∞–º—è—Ç—å

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –ø–∞–º—è—Ç–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã:

1.  **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å (—Å–ª–æ—Ç—ã)**:
    *   **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è**: Redis.
    *   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π (—Ç–∞–∫–∏—Ö –∫–∞–∫ `product`, `task`, `file_key`) –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≥–µ–Ω—Ç–∞–º –±—ã—Å—Ç—Ä–æ –ø–æ–ª—É—á–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞.

2.  **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å (–ª–æ–≥–∏ –¥–∏–∞–ª–æ–≥–æ–≤)**:
    *   **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è**: SQLite, —Ç–∞–±–ª–∏—Ü–∞ `dialog_log`.
    *   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –ø–æ–ª–Ω–∞—è –≤–µ—Ç–∫–∞ –¥–∏–∞–ª–æ–≥–∞ (–≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏.

3.  **–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (–≤–µ–∫—Ç–æ—Ä—ã)**:
    *   **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è**: Qdrant, –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `docs` –∏ `dialogs`.
    *   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**:
        *   **`docs`**: –•—Ä–∞–Ω–∏—Ç –≤–µ–∫—Ç–æ—Ä—ã –∏–∑ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (PDF, DOCX –∏ —Ç.–¥.).
        *   **`dialogs`**: –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ –ø–∞—Ä–∞ (–≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞) –≤–µ–∫—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —ç—Ç—É –∫–æ–ª–ª–µ–∫—Ü–∏—é.
    *   **–ü—Ä–æ—Ü–µ—Å—Å –ø–æ–∏—Å–∫–∞**: `KB-Search-Agent` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–∏—Å–∫ —Å —É–º–Ω—ã–º –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:
        *   **–≠—Ç–∞–ø 1**: –ü–æ–∏—Å–∫ –≤ `dialogs` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π similarity score (‚â•0.95 = reuse, 0.60-0.95 = –∫–æ–Ω—Ç–µ–∫—Å—Ç).
        *   **–≠—Ç–∞–ø 2**: –ü–æ–∏—Å–∫ –≤ `docs` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è RAG-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
        *   **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –õ–∏–±–æ –≥–æ—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –∏–∑ –ø–∞–º—è—Ç–∏, –ª–∏–±–æ –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è Planner'–∞.

### –ù–æ–≤–∞—è —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**Dialog Manager** –∑–∞–º–µ–Ω–∏–ª —Å–ª–æ–∂–Ω—ã–π Router –∏ —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –ø—Ä–æ—Å—Ç–æ–π –ª–æ–≥–∏–∫–µ:

1. **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è small_talk / file / request** –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–æ–¥–µ–ª—å—é **o3-mini** –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–º—É –ø—Ä–æ–º–ø—Ç—É, –±–µ–∑ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ª–æ–≤–∞—Ä–µ–π.
2. **DM-Critic (4.1-mini)** –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ—à–µ–Ω–∏–µ (score ‚â• 0.5).
3. **File shortcuts** ‚Äî –µ—Å–ª–∏ –≤ slots –µ—Å—Ç—å `file_key`, —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª
4. **–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ** ‚Äî –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è **Planner**-–∞–≥–µ–Ω—Ç—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

**Planner** –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:
- `need_clarify: true` ‚Üí –∑–∞–ø—Ä–æ—Å —É—Ç–æ—á–Ω–µ–Ω–∏—è —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `need_escalate: true` ‚Üí –ø–µ—Ä–µ–¥–∞—á–∞ —Å–ª–æ–∂–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–π –≥—Ä—É–ø–ø–µ (ExpertGC)
- `draft` ‚Üí –≥–æ—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

### –î–∏–∞–ª–æ–≥-–º–µ–Ω–µ–¥–∂–µ—Ä

1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ slots (product/task/‚Ä¶).
2. o3-mini –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç intent ‚Üí {file | kb_search | request | small_talk} + confidence.
3. DM-Critic (4.1-mini) –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç. –ï—Å–ª–∏ <0.5 ‚Üí intent=unknown.
4. unknown / small_talk ‚Üí follow-up –∏–ª–∏ courtesy.
5. file ‚Üí File-Search; **kb_search/request** ‚Üí **KB-Search-Agent** ‚Üí Planner.

### KB-Search-Agent

**–ù–æ–≤—ã–π –∞–≥–µ–Ω—Ç** –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:

1. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏—é `dialogs`**:
   - **‚â•0.95** ‚Üí –æ—Ç–≤–µ—Ç –∏–∑ –ø–∞–º—è—Ç–∏ (reuse).
   - **0.60‚Äì0.95** ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç `similar_dialogs` –≤ context.
   - **<0.60** ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –∫–∞–∫ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ.

2. **–ó–∞–±–∏—Ä–∞–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã `docs` (RAG)**:
   - –ü–æ–∏—Å–∫ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º `k`.
   - –î–æ–±–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ `context.rag`.

3. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (status, context) Dialog-Manager'—É**:
   - `("reuse", answer)` ‚Üí –≥–æ—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
   - `("escalate", context)` ‚Üí –ø–µ—Ä–µ–¥–∞—á–∞ Planner'—É —Å –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.

**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π k**: `k = max(3, min(10, expected_tokens // 400))` ‚Äî –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∂–∏–¥–∞–µ–º–æ–π –¥–ª–∏–Ω—ã –æ—Ç–≤–µ—Ç–∞.

### Expert-GC

**–≠–∫—Å–ø–µ—Ä—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞** –ø–æ–ª—É—á–∞–µ—Ç –ø–ª–∞–Ω –æ—Ç Planner'–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ –µ–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

- **–ü–æ–ª—É—á–∞–µ—Ç `context.plan[]`** –∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ —à–∞–≥–∞–º.
- **–ü–æ–º–µ—á–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã** –≥–∞–ª–æ—á–∫–æ–π ‚úì.
- **–°–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ**: *"–°–ª–µ–¥—É–π –ø–æ —à–∞–≥–∞–º –ø–ª–∞–Ω–∞: —à–∞–≥1, —à–∞–≥2, —à–∞–≥3. –û—Ç–º–µ—á–∞–π –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç –≥–∞–ª–æ—á–∫–æ–π ‚úì."*
- **–ê–≥–µ–Ω—Ç—ã**: Expert (gpt-4.1), Critic (gpt-4.1-mini), Search (o3-mini).
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: `local_search` –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ü–∏—Ç–∞—Ç–∞–º–∏.

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `web_search`
* –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ OpenAI Browser-tool.
* –¢–∞–π–º–∞—É—Ç –∑–∞–¥–∞—ë—Ç—Å—è `WEB_SEARCH_TIMEOUT_SEC` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20 —Å).
* –ü—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ —Ç–∞–π–º–∞—É—Ç–∞ Search-–∞–≥–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É **TIMEOUT**,
  Critic —Å–Ω–∏–∂–∞–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å ‚Üí Expert-GC –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ fallback-—Ü–∏–∫–ª—É.

### UX Flow

–ü–µ—Ä–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ (¬´–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! ...¬ª) –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ
–ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–∏—à–µ—Ç
¬´–ü—Ä–∏–≤–µ—Ç¬ª ‚Äî –±—ç–∫–µ–Ω–¥ –æ—Ç–≤–µ—á–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º –≤—Ç–æ—Ä–æ–π —Ä–∞–∑.

## Frontend Dev

```bash
cd frontend
npm i         # –ø–µ—Ä–≤—ã–π —Ä–∞–∑
npm run dev   # http://localhost:5173
```

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- React + TypeScript
- Tailwind CSS –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
- WebSocket –¥–ª—è real-time –æ–±—â–µ–Ω–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º
- –†–æ–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π: `user`, `assistant`, `assistant(f/u)` –¥–ª—è follow-up –æ—Ç–≤–µ—Ç–æ–≤

### –¢–∞–π–º–∞—É—Ç—ã
| Env                | default | –ß—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç |
|--------------------|---------|------------------|
| GC_TIMEOUT_SEC     | 300     | Expert-GC (AutoGen) |
| WEB_SEARCH_TIMEOUT_SEC | 20  | web-browser search-tool |

–ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ç–∞–π–º–∞—É—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–µ
—Å–æ–æ–±—â–µ–Ω–∏–µ ¬´‚ö†Ô∏è –í—Ä–µ–º—è –≤—ã—à–ª–æ‚Ä¶¬ª.  –ó–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å
–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å—Ä–µ–¥—ã (docker-compose, Helm values).

## –û—Ç–ª–∞–¥–∫–∞ Planner

–ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç —Å—ã—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –º–æ–¥–µ–ª–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:

```bash
# –ü–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö SQLite
sqlite3 /data/chatlog.db

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å—ã—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –º–æ–¥–µ–ª–∏
select content from chatlog where role='raw' order by id desc limit 5;

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ JSON –ø–æ –≤—Ä–µ–º–µ–Ω–∏
select ts, content from chatlog where role='raw' and ts > datetime('now', '-1 hour');

# –ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö —Å—ã—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
select turn_index, content from chatlog where thread_id='your-thread-id' and role='raw';
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- –ú–æ–¥–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
- –ù–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –≤ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø–æ–ª—è—Ö
- –õ–∏—à–Ω–∏–µ –∑–∞–ø—è—Ç—ã–µ –≤ –∫–æ–Ω—Ü–µ –æ–±—ä–µ–∫—Ç–æ–≤
- –û—Ç–≤–µ—Ç –Ω–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON

**–†–µ—à–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ—Ç—Å—è –∏–∑–≤–ª–µ—á—å JSON –∏–∑ —Ç–µ–∫—Å—Ç–∞, –Ω–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "ü§ñ –ü–æ–∫–∞ –Ω–µ –ø–æ–Ω—è–ª —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É, —É—Ç–æ—á–Ω–∏—Ç–µ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞."