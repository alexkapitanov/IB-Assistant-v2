<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IB Assistant - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Dialog Manager</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { border: 1px solid #ccc; margin: 10px 0; padding: 15px; border-radius: 8px; }
        .test-title { font-weight: bold; color: #0066cc; margin-bottom: 10px; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
        button { background: #0066cc; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0052a3; }
        .response { background: #f5f5f5; padding: 10px; border-radius: 4px; margin: 10px 0; white-space: pre-wrap; }
        .status { padding: 5px 10px; border-radius: 4px; margin: 5px 0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üß™ IB Assistant - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Dialog Manager</h1>
    
    <div class="test-section">
        <div class="test-title">1Ô∏è‚É£ –¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è (small-talk)</div>
        <button onclick="testGreeting()">–¢–µ—Å—Ç: "–ø—Ä–∏–≤–µ—Ç"</button>
        <div id="greeting-status"></div>
        <div id="greeting-response" class="response"></div>
    </div>

    <div class="test-section">
        <div class="test-title">2Ô∏è‚É£ –¢–µ—Å—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ (Planner draft)</div>
        <button onclick="testPlanner()">–¢–µ—Å—Ç: "—á—Ç–æ —Ç–∞–∫–æ–µ SOC?"</button>
        <div id="planner-status"></div>
        <div id="planner-response" class="response"></div>
    </div>

    <div class="test-section">
        <div class="test-title">3Ô∏è‚É£ –¢–µ—Å—Ç —ç—Å–∫–∞–ª–∞—Ü–∏–∏ –∫ —ç–∫—Å–ø–µ—Ä—Ç—É (Expert-GC)</div>
        <button onclick="testExpert()">–¢–µ—Å—Ç: "–°—Ä–∞–≤–Ω–∏ Infowatch DLP –∏ Falcongaze SecureTower"</button>
        <div id="expert-status"></div>
        <div id="expert-response" class="response"></div>
    </div>

    <div class="test-section">
        <div class="test-title">üîß –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å</div>
        <textarea id="customQuery" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å..."></textarea>
        <button onclick="testCustom()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <div id="custom-status"></div>
        <div id="custom-response" class="response"></div>
    </div>

    <script>
        const WS_URL = 'ws://localhost:8000/ws';
        
        function setStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        function setResponse(elementId, content) {
            document.getElementById(elementId).textContent = content;
        }

        async function testWebSocket(query, statusId, responseId) {
            setStatus(statusId, 'üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket...', 'info');
            
            try {
                const ws = new WebSocket(WS_URL);
                
                return new Promise((resolve, reject) => {
                    ws.onopen = () => {
                        setStatus(statusId, '‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...', 'success');
                        ws.send(JSON.stringify({ message: query }));
                    };

                    ws.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        setStatus(statusId, '‚úÖ –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç!', 'success');
                        setResponse(responseId, JSON.stringify(data, null, 2));
                        ws.close();
                        resolve(data);
                    };

                    ws.onerror = (error) => {
                        setStatus(statusId, `‚ùå –û—à–∏–±–∫–∞ WebSocket: ${error}`, 'error');
                        reject(error);
                    };

                    ws.onclose = () => {
                        setStatus(statusId, 'üîå WebSocket –∑–∞–∫—Ä—ã—Ç', 'info');
                    };

                    // Timeout –ø–æ—Å–ª–µ 30 —Å–µ–∫—É–Ω–¥
                    setTimeout(() => {
                        if (ws.readyState === WebSocket.OPEN) {
                            ws.close();
                            setStatus(statusId, '‚è∞ –¢–∞–π–º–∞—É—Ç 30 —Å–µ–∫—É–Ω–¥', 'error');
                            reject(new Error('Timeout'));
                        }
                    }, 30000);
                });
            } catch (error) {
                setStatus(statusId, `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                throw error;
            }
        }

        async function testGreeting() {
            await testWebSocket('–ø—Ä–∏–≤–µ—Ç', 'greeting-status', 'greeting-response');
        }

        async function testPlanner() {
            await testWebSocket('—á—Ç–æ —Ç–∞–∫–æ–µ SOC?', 'planner-status', 'planner-response');
        }

        async function testExpert() {
            await testWebSocket('–°—Ä–∞–≤–Ω–∏ Infowatch DLP –∏ Falcongaze SecureTower –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏', 'expert-status', 'expert-response');
        }

        async function testCustom() {
            const query = document.getElementById('customQuery').value.trim();
            if (!query) {
                setStatus('custom-status', '‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å', 'error');
                return;
            }
            await testWebSocket(query, 'custom-status', 'custom-response');
        }

        // –ê–≤—Ç–æ—Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            console.log('üöÄ Dialog Manager UI —Ç–µ—Å—Ç –∑–∞–≥—Ä—É–∂–µ–Ω');
            setStatus('greeting-status', 'üéØ –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é', 'info');
            setStatus('planner-status', 'üéØ –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é', 'info');
            setStatus('expert-status', 'üéØ –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é', 'info');
            setStatus('custom-status', 'üéØ –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é', 'info');
        });
    </script>
</body>
</html>
